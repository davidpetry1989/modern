{% extends "partials/base.html" %}
{% load static %}
{% block title %}De/Para — {{ target_label }}{% endblock title %}
{% block content %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">

      {% with titulo="De/Para — "|add:target_label %}
        {% include "partials/page-title.html" with pagetitle="Importações" title=titulo %}
      {% endwith %}

      {% if messages %}
        {% for message in messages %}
          <div class="alert {{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Mapeamentos (De/Para)</h5>
            <a href="{% url 'importacao:depara_add' target %}" class="btn btn-success">
              <i class="ri-add-fill me-1"></i>Novo
            </a>
          </div>

          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-light">
                <tr>
                  <th>Cód</th>
                  <th>Layout</th>
                  <th>Código Externo</th>
                  <th>Descrição Externa</th>
                  <th>Destino</th>
                  <th>Ativo</th>
                  <th>Atualizado em</th>
                  <th class="text-end">Ações</th>
                </tr>
              </thead>
              <tbody>
                {% for item in itens %}
                  <tr>
                    <td>{{ item.id }}</td>
                    <td>{{ item.layout.nome }}</td>
                    <td>
                      <a href="{% url 'importacao:depara_edit' target item.pk %}">{{ item.codigo_externo }}</a>
                    </td>
                    <td>{{ item.descricao_externa }}</td>
                    <td>{{ item.target }}</td>
                    <td>{{ item.ativo|yesno:"Sim,Não" }}</td>
                    <td>{{ item.updated_at|date:"d/m/Y H:i" }}</td>
                    <td class="text-end">
                      <a href="{% url 'importacao:depara_edit' target item.pk %}" class="btn btn-sm btn-primary">
                        <i class="ri-pencil-line"></i>
                      </a>
                    </td>
                  </tr>
                {% empty %}
                  <tr><td colspan="7" class="text-center">Nenhum item encontrado.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          {% if is_paginated %}
          <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination justify-content-center">
              {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a></li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Anterior</span></li>
              {% endif %}
              <li class="page-item disabled"><span class="page-link">Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span></li>
              {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Próxima</a></li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Próxima</span></li>
              {% endif %}
            </ul>
          </nav>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock content %}
