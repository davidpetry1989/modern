{% extends "partials/base.html" %}
{% load static %}
{% block title %}Lançamento{% endblock title %}
{% block content %}
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      {% include "partials/page-title.html" with pagetitle="Movimentação" title="Lançamento Contábil" %}
      <div class="card">
        <div class="card-body">
          <form method="post">
            {% csrf_token %}
            {% if form.non_field_errors %}<div class="alert alert-danger">{{ form.non_field_errors }}</div>{% endif %}
            <div class="row g-3">
              {% if form.data_lancamento %}
              <div class="col-md-3">
                {{ form.data_lancamento.label_tag }}{{ form.data_lancamento }}
                {% for error in form.data_lancamento.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.data_competencia %}
              <div class="col-md-3">
                {{ form.data_competencia.label_tag }}{{ form.data_competencia }}
                {% for error in form.data_competencia.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.filial %}
              <div class="col-md-3">
                {{ form.filial.label_tag }}{{ form.filial }}
                {% for error in form.filial.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.numero_documento %}
              <div class="col-md-3">
                {{ form.numero_documento.label_tag }}{{ form.numero_documento }}
                {% for error in form.numero_documento.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.tipo_lancamento %}
              <div class="col-md-3">
                {{ form.tipo_lancamento.label_tag }}{{ form.tipo_lancamento }}
                {% for error in form.tipo_lancamento.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.origem %}
              <div class="col-md-3">
                {{ form.origem.label_tag }}{{ form.origem }}
                {% for error in form.origem.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.status %}
              <div class="col-md-3">
                <div class="form-check mt-4">
                  {{ form.status }}
                  <label class="form-check-label" for="{{ form.status.id_for_label }}">{{ form.status.label }}</label>
                </div>
                {% for error in form.status.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
              {% if form.descricao %}
              <div class="col-12">
                {{ form.descricao.label_tag }}{{ form.descricao }}
                {% for error in form.descricao.errors %}<div class="invalid-feedback d-block">{{ error }}</div>{% endfor %}
              </div>
              {% endif %}
            </div>
            <hr class="my-4">
            <div id="grid-itens"
                 data-url-cc="{% url 'contabill:lancamentos_rateio_cc' %}"
                 data-url-projeto="{% url 'contabill:lancamentos_rateio_projeto' %}">
              {% include "contabill/lancamentos/_grid_itens.html" with formset=itens_formset form_novo=form_novo %}
            </div>
            <div class="mt-3">
              <button type="submit" class="btn btn-success" id="btn-salvar" disabled>Salvar</button>
              <a href="{% url 'contabill:lancamentos_lista' %}" class="btn btn-secondary">Cancelar</a>
            </div>
          </form>
          <div class="row mt-4">
            <div class="col-md-6" id="grid-cc" hx-swap="outerHTML">
              {% include "contabill/lancamentos/_grid_cc.html" with formset=None %}
            </div>
            <div class="col-md-6" id="grid-projeto" hx-swap="outerHTML">
              {% include "contabill/lancamentos/_grid_projeto.html" with formset=None %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="{% static 'contabill/js/lancamentos.js' %}"></script>
<script>
document.body.addEventListener("htmx:afterSwap", function (evt) {
  if (evt.target.id === "grid-itens" && typeof window.recalcLancamentos === "function") {
    window.recalcLancamentos();
  }
});
</script>
{% endblock content %}
